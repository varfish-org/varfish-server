<!--
  Component to display gene details.

  The component uses a wrapping list of cards to present the information.
-->
<script setup lang="ts">
import { computed } from 'vue'

import { stopWords } from '@variants/components/Gene.fields'
import GtexGenePlot from '@variants/components/VariantDetails/GtexGenePlot.vue'
import ClinvarFreqPlot from '@variants/components/VariantDetails/ClinvarFreqPlot.vue'
import { useVariantQueryStore } from '@variants/stores/variantQuery'
import { roundIt } from '@varfish/moreUtils'

export interface Props {
  /** Gene information from annonars. */
  gene: any
  /** Clinvar-Gene information from annonars. */
  geneClinvar: any
  /** Small variant information record (used for UMD linkout). */
  smallVar?: any
  /** Whether HGMD Pro display is enabled. */
  hgmdProEnabled?: boolean
  /** The URL prefix to HGMD Pro. */
  hgmdProPrefix?: string
}

const props = withDefaults(defineProps<Props>(), {
  smallVar: null,
  hgmdProEnabled: false,
  hgmdProPrefix: '',
})

const variantImpactLabels = [
  "3' UTR",
  "5' UTR",
  'downstream',
  'frameshift',
  'inframe indel',
  'start lost',
  'intron',
  'missense',
  'non-coding',
  'stop gained',
  'no alteration',
  'splice acceptor',
  'splice donor',
  'stop lost',
  'synonymous',
  'upstream gene',
  'overall',
]

const clinsigLabels = [
  'benign', // 0
  'likely benign', // 1
  'uncertain signifiance', // 2
  'likely pathogenic', // 3
  'pathogenic', // 4
]

const clinsigColor = ['#5d9936', '#a3f56c', '#f5c964', '#f59f9f', '#b05454']

const perImpactCounts = computed(() => {
  const result = []
  const sum = {
    impact: variantImpactLabels?.length - 1,
    counts: [0, 0, 0, 0, 0],
  }
  if (props?.geneClinvar?.perImpactCounts?.length) {
    for (const perImpactCount of props.geneClinvar?.perImpactCounts) {
      result.push(perImpactCount)
      for (let i = 0; i < sum.counts.length; ++i) {
        sum.counts[i] += perImpactCount.counts[i]
      }
    }
    result.push(sum)
  }
  return result
})

const variantQueryStore = useVariantQueryStore()

const linkOutPubMedHpoTerms = computed((): string | null => {
  if (props.gene?.hgnc?.symbol && variantQueryStore.hpoNames?.length) {
    const symbol = props.gene.hgnc.symbol
    const tokens = (variantQueryStore.hpoNames ?? [])
      .join(' ')
      .toLowerCase()
      .split(/\W+/)
      .filter((token) => !stopWords.includes(token))
    const terms = tokens.join('+OR+')
    return `https://www.ncbi.nlm.nih.gov/pubmed/?term=${symbol}+AND+(${terms})`
  } else {
    return null
  }
})
</script>

<template>
  <div class="row pr-2 pt-2" style="font-size: 90%">
    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%"> HGNC </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div>
            <strong>symbol:</strong>
            {{ gene?.hgnc?.symbol }}
          </div>
          <div>
            <strong>name:</strong>
            {{ gene?.hgnc?.name }}
          </div>
          <div>
            <strong>cytoband:</strong>
            {{ gene?.hgnc?.location }}
          </div>
          <div>
            <strong>aliases:</strong>
            {{ gene?.hgnc?.aliasName?.join(', ') }}
          </div>
          <div>
            <strong>synonyms:</strong>
            {{ gene?.hgnc?.aliasSymbol?.join(', ') }}
          </div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0" v-if="gene?.gnomadConstraints">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            Constraints / Scores
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div>
            <strong>gnomAD</strong>
            <table style="width: 100%" class="constraints-table">
              <thead class="text-center">
                <tr>
                  <th>Category</th>
                  <th>SNVs exp.</th>
                  <th>SNVs obs.</th>
                  <th>Constraint metrics</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Synonymous</td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.expSyn, 1)"
                  ></td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.obsSyn, 1)"
                  ></td>
                  <td class="pl-2">
                    Z =
                    <span
                      v-html="roundIt(gene?.gnomadConstraints?.synZ)"
                    /><br />
                    o/e =
                    <span v-html="roundIt(gene?.gnomadConstraints?.oeSyn)" />
                    (<span
                      v-html="roundIt(gene?.gnomadConstraints?.oeSynLower)"
                    />
                    -
                    <span
                      v-html="roundIt(gene?.gnomadConstraints?.oeSynUpper)"
                    />)
                  </td>
                </tr>
                <tr>
                  <td>Missense</td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.expMis, 1)"
                  ></td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.obsMis, 1)"
                  ></td>
                  <td class="pl-2">
                    Z =
                    <span
                      v-html="roundIt(gene?.gnomadConstraints?.mis_z)"
                    /><br />
                    o/e =
                    <span v-html="roundIt(gene?.gnomadConstraints?.oeMis)" />
                    (<span
                      v-html="roundIt(gene?.gnomadConstraints?.oeMisLower)"
                    />
                    -
                    <span
                      v-html="roundIt(gene?.gnomadConstraints?.oeMisUpper)"
                    />)
                  </td>
                </tr>
                <tr>
                  <td>pLoF</td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.expLof, 1)"
                  ></td>
                  <td
                    class="text-right pr-2"
                    v-html="roundIt(gene?.gnomadConstraints?.obsLof, 1)"
                  ></td>
                  <td class="pl-2">
                    pLI =
                    <span
                      v-html="roundIt(gene?.gnomadConstraints?.pli)"
                    /><br />
                    o/e =
                    <span v-html="roundIt(gene?.gnomadConstraints?.oeLof)" />
                    (<span
                      v-html="roundIt(gene?.gnomadConstraints?.oeLofLower)"
                    />
                    -
                    <mark
                      class="bg-warning"
                      v-html="
                        roundIt(gene?.gnomadConstraints?.oeLofUpper, 2, 'LOEUF')
                      "
                    />)
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div>
            <strong>
              rCNV
              <small>
                (<a
                  href="https://europepmc.org/article/MED/35917817"
                  target="_blank"
                  >Collins et al. (2022);
                </a>
                higher value: more likely dosage sensitive)
              </small>
            </strong>
            <br />
            <span v-if="gene?.rcnv !== undefined && gene?.rcnv !== null">
              pHaplo <span v-html="roundIt(gene?.rcnv?.p_haplo, 3)" />
              <br />
              pTriplo <span v-html="roundIt(gene?.rcnv?.p_triplo, 3)" />
            </span>
            <span v-else class="text-muted font-italic">
              no pHaplo/pTriplo scores available
            </span>
          </div>
          <div>
            <strong>
              sHet
              <small>
                (<a
                  href="https://europepmc.org/article/MED/28369035"
                  target="_blank"
                  >Weghorn, Balick et al. (2019);
                </a>
                higher value: more likley dosage intolerant)
              </small>
            </strong>
            <br />
            <span
              v-if="
                gene?.shet?.s_het !== undefined && gene?.shet?.s_het !== null
              "
              v-html="roundIt(gene?.shet?.s_het, 3)"
            />
            <span v-else class="text-muted font-italic">
              no sHet score available
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            NCBI Summary
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div class="overflow-auto" style="max-height: 200px; font-size: 90%">
            {{ gene?.ncbi?.summary }}
            <a
              :href="`https://www.ncbi.nlm.nih.gov/gene/${gene?.hgnc?.hgncId}`"
              target="_blank"
            >
              <i-mdi-launch />
              source
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            Alternate Identifiers
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div>
            <strong> ENSEMBL: </strong>
            <a
              :href="`https://www.ensembl.org/Homo_sapiens/Gene/Summary?g=${gene?.hgnc?.ensemblGeneId}`"
              target="_blank"
            >
              <i-mdi-launch />
              {{ gene?.hgnc?.ensembl_gene_id }}
            </a>
          </div>
          <div>
            <strong> HGNC: </strong>
            <a
              :href="`https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${gene?.hgnc?.hgncId}`"
              target="_blank"
            >
              <i-mdi-launch />
              {{ gene?.hgnc?.hgncId }}
            </a>
          </div>
          <div v-if="gene?.hgnc?.mgdId?.length">
            <strong>MGI: </strong>
            <template v-for="(mgdId, index) in gene.hgnc.mgdId">
              <template v-if="index > 0">, </template>
              <a
                :href="`https://www.informatics.jax.org/marker/${mgdId}`"
                target="_blank"
              >
                <i-mdi-launch />
                {{ mgdId }}
              </a>
            </template>
          </div>
          <span class="text-muted" v-else> No MGI </span>
          <div v-if="gene?.hgnc?.pubmedId?.length">
            <strong>Primary PMID: </strong>
            <template v-for="(pmid, index) in gene.hgnc.pubmedId">
              <template v-if="index > 0">, </template>
              <a
                :href="`https://pubmed.ncbi.nlm.nih.gov/${pmid}/`"
                target="_blank"
              >
                <i-mdi-launch />
                {{ pmid }}
              </a>
            </template>
          </div>
          <div v-else class="text-muted">No primary PMID</div>
          <div v-if="gene?.hgnc?.refseqAccession?.length">
            <strong> RefSeq: </strong>
            <template v-for="(accession, index) in gene.hgnc.refseqAccession">
              <template v-if="index > 0">, </template>
              <a
                :href="`https://www.ncbi.nlm.nih.gov/nuccore/?term=${accession}+AND+srcdb_refseq[PROP]`"
                target="_blank"
              >
                <i-mdi-launch />
                {{ accession }}
              </a>
            </template>
          </div>
          <div v-else class="text-muted">No RefSeq</div>
          <div v-if="gene?.hgnc?.uniprotIds?.length">
            <strong> UniProt: </strong>
            <template v-for="(uniprotid, index) in gene.hgnc.uniprotIds">
              <template v-if="index > 0">, </template>
              <a
                :href="`https://www.uniprot.org/uniprotkb/${uniprotid}/entry`"
                target="_blank"
              >
                {{ uniprotid }}
              </a>
            </template>
          </div>
          <div class="text-muted" v-else>No UniProt</div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            External Resources
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div class="row">
            <div class="col-6 p-0">
              <div>
                <a
                  :href="`https://cancer.sanger.ac.uk/cosmic/gene/analysis?ln=${gene?.hgnc?.cosmic}`"
                  target="_blank"
                  v-if="gene?.hgnc?.cosmic"
                >
                  <i-mdi-launch />
                  COSMIC
                </a>
                <span v-else class="text-muted pt-3">
                  <i-mdi-launch /> COSMIC</span
                >
              </div>

              <div>
                <a
                  :href="`https://www.deciphergenomics.org/gene/${gene?.hgnc?.symbol}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  DECIPHER
                </a>
              </div>
              <div>
                <a
                  :href="`https://search.thegencc.org/genes/${gene?.hgnc?.hgncId}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  GenCC
                </a>
              </div>
              <div>
                <a
                  :href="`${props.hgmdProPrefix}/gene.php?gene=${gene?.hgnc?.symbol}`"
                  target="_blank"
                  v-if="props.hgmdProEnabled"
                >
                  <i-mdi-launch />
                  HGMD Pro
                </a>
                <span class="text-muted" v-else>
                  <i-mdi-launch />
                  HGMD Pro
                </span>
              </div>
              <div>
                <a
                  :href="`https://www.kegg.jp/kegg-bin/search_pathway_text?map=map&keyword=${gene?.hgnc?.symbol}&mode=1&viewImage=true`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  KEGG
                </a>
              </div>
              <div>
                <a
                  :href="`https://medlineplus.gov/genetics/gene/${gene?.hgnc?.symbol}/`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  MedLinePlus
                </a>
              </div>
              <div>
                <a
                  :href="`https://www.omim.org/entry/${gene?.hgnc?.omimId[0]}`"
                  target="_blank"
                  v-if="gene?.hgnc?.omimId?.length"
                >
                  <i-mdi-launch />
                  OMIM
                </a>
                <span v-else class="text-muted pt-3">
                  <i-mdi-launch /> OMIM</span
                >
              </div>
            </div>
            <div class="col-6 p-0">
              <div>
                <a
                  :href="`https://pubmed.ncbi.nlm.nih.gov/?term=${gene?.hgnc?.symbol}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  PubMed
                </a>
              </div>
              <div>
                <a
                  v-if="linkOutPubMedHpoTerms?.length"
                  :href="linkOutPubMedHpoTerms"
                  target="_blank"
                >
                  <i-mdi-launch />
                  PubMed + HPO Terms
                </a>
                <span v-else class="text-muted">
                  <i-mdi-launch />
                  PubMed + HPO Terms (no terms)
                </span>
              </div>

              <div>
                <a
                  :href="`https://www.malacards.org/search/results?query=+[GE]+${gene?.hgnc?.symbol}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  MalaCards
                </a>
              </div>
              <div>
                <a
                  :href="`https://mastermind.genomenon.com/detail?gene=${gene?.hgnc?.symbol}&disease=all%20diseases`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  MASTERMIND
                </a>
              </div>

              <div v-if="props.smallVar">
                <a
                  :href="`https://stuart.radboudumc.nl/metadome/dashboard/transcript/${smallVar.ensemblTranscriptId}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  MetaDome
                </a>
              </div>

              <div>
                <template v-if="gene?.hgnc?.uniprotIds?.length">
                  <template v-for="(uniprotid, index) in gene.hgnc.uniprotIds">
                    <template v-if="index > 0">, </template>
                    <a
                      :href="`http://missense3d.bc.ic.ac.uk:8080/search_direct?uniprot=${uniprotid}`"
                      target="_blank"
                    >
                      <i-mdi-launch />
                      {{ uniprotid }}
                    </a>
                    (Missense3D)
                  </template>
                </template>
                <span v-else class="text-muted pt-3">
                  <i-mdi-launch /> Missense3D
                </span>
              </div>
              <div>
                <a
                  :href="`https://varsome.com/gene/hg19/${gene?.hgnc?.hgncId}`"
                  target="_blank"
                >
                  <i-mdi-launch />
                  VarSome
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            Disease Annotation
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div v-if="gene?.orpha?.orphaDiseases?.length" class="mb-2">
            <strong> Orphanet Disorders: </strong>
            <template v-for="(disease, idx) in gene.orpha?.orphaDiseases">
              <template v-if="idx > 0">, </template>
              <a
                :href="`https://www.orpha.net/consor/cgi-bin/OC_Exp.php?Expert=${disease.orphaId.replace(
                  'ORPHA:',
                  '',
                )}`"
                target="_blank"
              >
                {{ disease.label }}
              </a>
            </template>
          </div>
          <div v-else class="text-muted">No Orphanet disorders annotated.</div>

          <div v-if="gene?.omim?.omimDiseases?.length" class="mb-2">
            <strong> OMIM Diseases: </strong>
            <template v-for="(disease, idx) in gene.omim?.omimDiseases">
              <template v-if="idx > 0">, </template>
              <a
                :href="`https://www.omim.org/entry/${disease.omimId.replace(
                  'OMIM:',
                  '',
                )}`"
                target="_blank"
              >
                {{ disease.label }}
              </a>
            </template>
          </div>
          <div v-else class="text-muted">No OMIM diseases annotated.</div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            ClinGen
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <div
            v-if="gene?.clingen?.diseaseRecords?.length"
            class="overflow-auto mb-2"
            style="max-height: 200px; font-size: 90%"
          >
            <div
              v-for="(diseaseRecord, idx) in gene.clingen?.diseaseRecords"
              :class="{ 'mt-3': idx > 0 }"
            >
              <div class="font-weight-bolder">
                <a :href="diseaseRecord.diseaseUrl" target="_blank">
                  {{ diseaseRecord.diseaseLabel }}
                </a>
              </div>
              <div>
                <strong>
                  <abbr title="haploinsufficiency"> haplo. </abbr>
                </strong>
                {{ diseaseRecord.dosageHaploinsufficiencyAssertion }}
              </div>
              <div>
                <strong>
                  <abbr title="triplosensitivity"> triplo. </abbr>
                </strong>
                {{ diseaseRecord.dosageTriplosensitivityAssertion }}
              </div>

              <div>
                <strong> actionability </strong>
                <ul
                  v-if="
                    diseaseRecord?.actionabilityAssertionClassifications?.length
                  "
                  class="pl-3"
                >
                  <li
                    v-for="(
                      a, idx2
                    ) in diseaseRecord.actionabilityAssertionClassifications"
                  >
                    <em>{{ diseaseRecord.actionabilityGroups[idx2] }}: </em>
                    <a
                      :href="diseaseRecord.actionabilityAssertionReports[idx2]"
                      target="_blank"
                    >
                      {{
                        diseaseRecord.actionabilityAssertionClassifications[
                          idx2
                        ]
                      }}
                    </a>
                  </li>
                </ul>
                <div v-else class="text-muted font-italic">
                  no actionability assertions
                </div>
              </div>
              <div>
                <strong> validity </strong>
                <ul
                  v-if="
                    diseaseRecord?.geneDiseaseValidityAssertionClassifications
                      ?.length
                  "
                  class="pl-3"
                >
                  <li
                    v-for="(
                      a, idx2
                    ) in diseaseRecord.geneDiseaseValidityAssertionClassifications"
                  >
                    <em
                      >{{ diseaseRecord.geneDiseaseValidityGceps[idx2] }}:
                    </em>
                    <a
                      :href="
                        diseaseRecord.geneDiseaseValidityAssertionReports[idx2]
                      "
                      target="_blank"
                    >
                      {{
                        diseaseRecord
                          .geneDiseaseValidityAssertionClassifications[idx2]
                      }}
                    </a>
                  </li>
                </ul>
                <div v-else class="text-muted font-italic">
                  no gene-disease validity assertions
                </div>
              </div>
            </div>
          </div>
          <div v-else class="text-muted">No ClinGen annotation available</div>
        </div>
      </div>
    </div>
    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            ACMG Supplementary Findings List
          </span>
        </div>
        <div class="card-body pb-2 pt-2" v-if="gene?.acmgSf">
          <div>
            <strong>since ACMG SF:</strong>
            v{{ gene.acmgSf.sfListVersion }}
          </div>
          <div><strong>inheritance:</strong> {{ gene.acmgSf.inheritance }}</div>
          <div>
            <strong>phenotype:</strong>
            {{ gene.acmgSf.phenotypeCategory }} /
            {{ gene.acmgSf.diseasePhenotype }}
          </div>
        </div>
        <div v-else class="text-muted text-center font-italic">
          Gene is not on ACMG SF list.
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            GeneRIFs
          </span>
        </div>
        <div class="card-body pb-2 pt-2">
          <ul
            class="list-unstyled overflow-auto"
            style="max-height: 200px; font-size: 90%"
            v-if="gene?.ncbi?.rifEntries?.length"
          >
            <template v-for="entry in gene.ncbi.rifEntries">
              <li v-if="entry?.text?.length">
                {{ entry.text }}
                <a
                  :href="
                    'https://www.ncbi.nlm.nih.gov/pubmed/?term=' +
                    entry.pmids.join('+')
                  "
                  target="_blank"
                >
                  <i-mdi-launch />
                  PubMed
                </a>
              </li>
            </template>
          </ul>
          <div v-else class="text-muted text-center font-italic">
            No GeneRIFs available for gene.
          </div>
        </div>
      </div>
    </div>

    <div class="col-3 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            Locus-Specific Databases
          </span>
        </div>
        <div class="card-body pb-2 pt-2" v-if="gene?.hgnc?.lsdb?.length">
          <div v-for="{ name, url } in gene.hgnc.lsdb">
            <a :href="name" target="_blank">
              <i-mdi-launch />
              {{ url }}
            </a>
          </div>
          <div>
            <a
              :href="`https://www.kegg.jp/kegg-bin/search_pathway_text?map=map&keyword=${gene?.hgnc?.symbol}&mode=1&viewImage=true`"
              target="_blank"
            >
              <i-mdi-launch />
              KEGG
            </a>
          </div>
        </div>
        <div v-else class="text-muted text-center font-italic">
          No locus-specific database available for gene.
        </div>
      </div>
    </div>

    <div class="col-6 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            ClinVar By Impact
          </span>
        </div>
        <div class="card-body pb-2 pt-2" v-if="perImpactCounts?.length">
          <table class="table table-sm">
            <tr>
              <thead>
                <th>impact</th>
                <th v-for="i in [0, 1, 2, 3, 4]">
                  {{ clinsigLabels[i] }}
                </th>
                <th>total</th>
              </thead>
              <tbody>
                <tr v-for="row in perImpactCounts">
                  <td
                    :class="{
                      'font-weight-bolder':
                        variantImpactLabels[row.impact] == 'overall',
                    }"
                  >
                    {{ variantImpactLabels[row.impact] }}
                  </td>
                  <td
                    class="text-right"
                    :class="{
                      'font-weight-bolder':
                        variantImpactLabels[row.impact] == 'overall',
                    }"
                    v-for="(count, idx) in row.counts"
                    :style="`background-color: ${clinsigColor[idx]}`"
                  >
                    {{ count }}
                  </td>
                  <td
                    class="text-right"
                    :class="{
                      'font-weight-bolder':
                        variantImpactLabels[row.impact] == 'overall',
                    }"
                  >
                    {{ row.counts.reduce((a, b) => a + b, 0) }}
                  </td>
                </tr>
              </tbody>
            </tr>
          </table>
        </div>
        <div v-else class="text-muted text-center font-italic">
          No ClinVar data for gene.
        </div>
      </div>
    </div>

    <div class="col-8 mb-2 pl-2 pr-0">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            ClinVar By Frequency
          </span>
        </div>
        <div
          class="card-body pb-2 pt-2"
          v-if="geneClinvar?.perFreqCounts?.length"
        >
          <ClinvarFreqPlot
            :gene-symbol="gene?.hgnc?.symbol"
            :per-freq-counts="geneClinvar?.perFreqCounts"
          />
        </div>
        <div v-else class="text-muted text-center font-italic">
          No ClinVar data for gene.
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col mb-2 pl-2 pr-0 cols-12">
      <div class="card h-100">
        <div class="card-header pl-2 pt-1 pb-1 pr-2">
          <span class="font-weight-bolder" style="font-size: 120%">
            GTEx Expression
          </span>
          <small>
            <a
              :href="`https://gtexportal.org/home/gene/${gene?.gtex.ensemblGeneId}`"
              target="_blank"
              v-if="gene?.gtex"
            >
              <i-mdi-launch />
              GTEx Portal
            </a>
          </small>
        </div>
        <div class="card-body pb-2 pt-2 row" v-if="gene?.gtex">
          <GtexGenePlot
            :gene-symbol="gene?.hgnc?.symbol"
            :expression-records="gene.gtex.records"
          />
        </div>
        <div v-else class="text-muted text-center font-italic">
          No GTEx data available for gene.
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped="true">
table.constraints-table {
  border: 1px solid #30303030;
}
.constraints-table th,
.constraints-table td {
  border: 1px solid #30303030;
  background-color: #f0f0f0f0;
  padding: 2px;
}
</style>
